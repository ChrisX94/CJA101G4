<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>二手商城</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/header.css" />
  <link rel="stylesheet" href="../css/select_page.css" />

</head>

<body>

  <header class="header">
    <div class="header__logo">
      <a href="#"> <img src="../img/logoText.png" alt="Logo">
      </a>
    </div>
    <nav class="header__nav">
      <ul class="header__list">
        <li class="header__item"><a href="#">配對</a></li>
        <li class="header__item"><a href="#">聊天室</a></li>
        <li class="header__item"><a href="#">活動</a></li>
        <li class="header__item"><a href="#">討論區</a></li>
        <li class="header__item"><a href="#">商城</a></li>
        <li class="header__item"><a href="#">二手商城</a></li>
        <li class="header__item"><a href="#">會員專區</a></li>
      </ul>
    </nav>
    <i class="fa-solid fa-user"></i>
  </header>

  <!-- ✅ 側邊選單區塊 HTML（漢堡選單移入 sidebar 中） -->
  <div class="sidebar-wrapper">
    <div class="sidebar" id="sidebar">
      <!-- ✅ 漢堡選單按鈕，改為相對於 sidebar 包裹層定位 -->
      <button class="menu-toggle" id="menuToggle" onclick="toggleSidebar()">
        <i class="fa-solid fa-bars"></i>
      </button>
      <ul>
        <li><i class="fa-solid fa-user"></i> 會員中心</li>
        <li><i class="fa-solid fa-store"></i> 聊聊商城</li>
        <li><i class="fa-solid fa-headset"></i> 客服中心</li>
        <li><i class="fa-solid fa-gear"></i> 設定</li>
      </ul>
    </div>
  </div>

  <aside class="aside">
    <nav class="nav">
      <ul class="nav_list">
        <li><a href="#">商品類別</a></li>
      </ul>
    </nav>
  </aside>


  <div class="feature-bar">
    <a href="#" class="feature-link">瀏覽二手商品</a>
    <a href="product_manager.html" class="feature-link">我的二手商品</a>
    <a href="add_product.html" class="feature-link">上架二手商品</a>
    <a href="#" class="feature-link">已購賣商品</a>
  </div>



  <div class="search-bar">
    <input type="text" placeholder="輸入商品關鍵字">
    <button><i class="fa fa-search"></i></button>

    <div class="sort-buttons">
      <button class="sort-btn">價格 ↑</button>
      <button class="sort-btn">價格 ↓</button>
      <button class="sort-btn">最新</button>
      <button class="sort-btn">最舊</button>
    </div>
  </div>

  <main class="main">
    <ul class="item_list">
      目前沒有好友有商品，配對連結<a href="#"></a>

    </ul>
  </main>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script>
    $(function () {
      $("button.btn_hamburger").on("click", function () {
        $("aside.aside").toggleClass("-on");
      });
    });
  </script>

  <script>
    $(document).ready(function () {
      // 取得商品分類（aside）
      $.ajax({
        url: "http://localhost:8087/api/ShShop/allTypes",
        method: "GET",
        data: {
          action: "allTypes",
        },
        dataType: "json",
        success: function (response) {
          const typeData = response.data; //
          const navList = $(".nav_list");
          navList.empty();

          // 插入「所有商品」分類
          navList.append(`<li><a href="#">商品類別</a></li>`);

          typeData.forEach(type => {
            const typeHTML = `<li><a href="#">${type.prodTypeName}</a></li>`;
            navList.append(typeHTML);
          });
        },
        error: function (xhr, status, error) {
          console.error("載入分類失敗", error);
        }
      });

      // 取得商品列表
      $.ajax({
        url: "http://localhost:8087/api/ShShop/all",
        method: "GET",
        data: { action: "getAll" },
        dataType: "json",
        success: function (response) {
          const data = response.data;  // <== 這裡改成從 response 中取出 data
          const itemList = $(".item_list");
          itemList.empty(); // 清空原本的範例資料

          data.forEach(prod => {
            const imgSrc = prod.picUrls.length > 0 ? prod.picUrls[0] : "https://placehold.co/400x300";
            const itemHTML = `
        <li>
          <a href="product_page.html?id=${prod.prodId}">
            <div class="img_block">
              <img class="product_img" src="${imgSrc}" alt="${prod.prodName}">
            </div>
            <span class="item_text">
              ${prod.prodName}｜${prod.prodBrand}｜${prod.prodTypeName}
              <br><small class="owner">上架者：${prod.userName}</small>
            </span>
          </a>
        </li>
      `;
            itemList.append(itemHTML);
          });
        },
        error: function (xhr, status, error) {
          console.error("載入商品失敗", error);
        }
      });
    });
  </script>
</body>

</html>