<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My MatchMarket</title>
    <link rel="stylesheet" href="css/header.css" />
    <link rel="stylesheet" href="css/product_manager.css" />

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />


</head>

<body>

    <header class="header">
        <div class="header__logo">
            <a href="#"><img src="../../img/logoText.png" alt="Logo" /></a>
        </div>
        <nav class="header__nav">
            <ul class="header__list">
                <li class="header__item"><a href="#">é…å°</a></li>
                <li class="header__item"><a href="#">èŠå¤©å®¤</a></li>
                <li class="header__item"><a href="#">æ´»å‹•</a></li>
                <li class="header__item"><a href="#">è¨è«–å€</a></li>
                <li class="header__item"><a href="#">MatchMarket</a></li>
                <li class="header__item"><a href="#">æœƒå“¡å°ˆå€</a></li>
            </ul>
        </nav>
        <i class="fa-solid fa-user"></i>
    </header>

    <div class="feature-bar">
        <a href="select_page.html" class="feature-link">çœ‹ä¸€ä¸‹å•†å“</a>
        <a href="#" class="feature-link">My MatchMarket</a>
        <a href="add_product.html" class="feature-link">ä¸Šæ¶å•†å“</a>
        <a href="#" class="feature-link">å·²è³¼è³£å•†å“</a>
    </div>

    <!-- âœ… å´é‚Šæ¬„ -->
    <div class="sidebar">
        <h3>å•†å“ç®¡ç†</h3>
        <a href="#" id="view-all-btn" class="active">å…¨éƒ¨å•†å“</a>
        <a href="#" id="view-on-depending">æŸ¥çœ‹å¯©æ ¸ç‹€æ…‹</a>
        <a href="#" id="view-on-sale-btn">å·²ä¸Šæ¶å•†å“</a>
        <a href="#" id="view-on-delist-btn">å·²ä¸‹æ¶å•†å“</a>
    </div>

    <!-- âœ… ä¸»å…§å®¹ -->
    <div class="main-content">
        <div class="page-title">æˆ‘çš„å•†å“</div>

        <table>
            <thead>
                <tr>
                    <th>å•†å“åœ–ç‰‡</th>
                    <th>å•†å“åç¨±</th>
                    <th>åƒ¹æ ¼</th>
                    <th>æ•¸é‡</th>
                    <th>æè¿°</th>
                    <th>å•†å“ç‹€æ…‹</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>


    <script>
        function goToEdit(prodId, prodStatus) {
            localStorage.setItem("editingProdId", prodId);
            localStorage.setItem("prodStatus", prodStatus);
            window.location.href = "edit_product.html";
        }

        // åŸå§‹è¼‰å…¥å…¨éƒ¨å•†å“ï¼ˆç™»å…¥è€…çš„ï¼‰
        document.addEventListener("DOMContentLoaded", function () {
            loadAllProducts(); // é è¨­è¼‰å…¥æ‰€æœ‰å•†å“
        });

        function loadAllProducts() {
            fetch("http://localhost:8087/api/ShShop/myProds", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: new URLSearchParams({
                    action: "all" // é€™è£¡å¯ä»¥æ ¹æ“šéœ€è¦èª¿æ•´æŸ¥è©¢æ¢ä»¶
                })
            })
                .then(res => res.json())
                .then(res => {
                    if (!res || !res.data || !Array.isArray(res.data)) {
                        console.error("å›å‚³æ ¼å¼éŒ¯èª¤", res);
                        return;
                    }

                    const tbody = document.querySelector("tbody");
                    tbody.innerHTML = ""; // æ¸…ç©ºåŸæœ‰è³‡æ–™

                    res.data.forEach(prod => {
                        const firstImg = prod.picUrls?.[0] || "https://via.placeholder.com/60";

                        const tr = document.createElement("tr");
                        tr.innerHTML = `
                        <td><img class="prod-img" src="${firstImg}" alt="å•†å“åœ–ç‰‡" /></td>
                        <td>${prod.prodName}</td>
                        <td>$${prod.prodPrice}</td>
                        <td>${prod.prodCount}</td>
                        <td>${prod.prodDesc || ''}</td>
                        <td>${prod.prodStatusStr || ''}</td>
                        <td>
                          <button type="button" class="edit-btn" onclick="goToEdit(${prod.prodId}, ${prod.prodStatus})">ä¿®æ”¹</button>
                        </td>
                    `;
                        tbody.appendChild(tr);
                    });
                })
                .catch(err => {
                    console.error("è¼‰å…¥å•†å“å¤±æ•—ï¼š", err);
                });
        }

        // é»é¸ã€Œå…¨éƒ¨å•†å“ã€æ™‚è¼‰å…¥æ‰€æœ‰å•†å“
        document.getElementById("view-all-btn").addEventListener("click", function (e) {
            e.preventDefault();
            loadAllProducts(); // é‡æ–°è¼‰å…¥æ‰€æœ‰å•†å“
        });
        //  é»é¸ã€Œå·²ä¸Šæ¶ä¸­å•†å“ã€æ™‚åªé¡¯ç¤ºä¸Šæ¶ä¸­çš„å•†å“ï¼Œä¸¦åŠ ä¸Šã€Œä¸‹æ¶ã€æŒ‰éˆ•
        document.getElementById("view-on-depending").addEventListener("click", function (e) {
            e.preventDefault();
            loadOnPendingProducts();
        });

        //  é»é¸ã€Œå·²ä¸Šæ¶ä¸­å•†å“ã€æ™‚åªé¡¯ç¤ºä¸Šæ¶ä¸­çš„å•†å“ï¼Œä¸¦åŠ ä¸Šã€Œä¸‹æ¶ã€æŒ‰éˆ•
        document.getElementById("view-on-sale-btn").addEventListener("click", function (e) {
            e.preventDefault();
            loadOnSaleProducts();
        });

        //  é»é¸ã€Œä¸‹æ¶å•†å“ã€æ™‚åªé¡¯ç¤ºä¸‹æ¶ä¸­çš„å•†å“
        document.getElementById("view-on-delist-btn").addEventListener("click", function (e) {
            e.preventDefault();
            loadOnDelistProducts();
        });


        function loadOnSaleProducts() {
            fetch("http://localhost:8087/api/ShShop/myProds", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: new URLSearchParams({ action: "available" })
            })
                .then(res => res.json())
                .then(res => {
                    if (!res || !res.data || !Array.isArray(res.data)) {
                        console.error("å›å‚³æ ¼å¼éŒ¯èª¤", res);
                        return;
                    }

                    const tbody = document.querySelector("tbody");
                    tbody.innerHTML = "";

                    const onSale = res.data;

                    if (onSale.length === 0) {
                        tbody.innerHTML = "<tr><td colspan='7'>ç›®å‰æ²’æœ‰ä¸Šæ¶ä¸­çš„å•†å“</td></tr>";
                        return;
                    }

                    onSale.forEach(prod => {
                        const firstImg = prod.picUrls?.[0] || "https://via.placeholder.com/60";
                        const tr = document.createElement("tr");


                        tr.innerHTML = `
                        <td><img class="prod-img" src="${firstImg}" alt="å•†å“åœ–ç‰‡" /></td>
                        <td>${prod.prodName}</td>
                        <td>$${prod.prodPrice}</td>
                        <td>${prod.prodCount}</td>
                        <td>${prod.prodDesc}</td>
                        <td>${prod.prodStatusStr}</td>
                        <td>
                            <button class="down-btn" onclick="deactivateProduct(${prod.prodId})">ä¸‹æ¶</button>
                        </td>
                    `;
                        tbody.appendChild(tr);
                    });
                })
                .catch(err => {
                    console.error("è¼‰å…¥ä¸Šæ¶å•†å“å¤±æ•—ï¼š", err);
                });
        }

        function deactivateProduct(prodId) {
            const confirmed = confirm("ç¢ºå®šè¦ä¸‹æ¶é€™å€‹å•†å“å—ï¼Ÿ");
            if (!confirmed) return;

            fetch("http://localhost:8087/api/ShShop/delist", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: new URLSearchParams({
                    prodId: prodId,
                    action: "deactivate"
                })
            })
                .then(res => res.json())
                .then(res => {
                    if (res.message === "success") {
                        alert("å•†å“å·²ä¸‹æ¶ï¼");
                        loadOnSaleProducts(); // ğŸ” é‡æ–°è¼‰å…¥ä¸Šæ¶ä¸­å•†å“
                    } else {
                        alert("ä¸‹æ¶å¤±æ•—ï¼š" + (res.message || "è«‹ç¨å¾Œå†è©¦"));
                    }
                })
                .catch(err => {
                    console.error("ä¸‹æ¶å¤±æ•—ï¼š", err);
                    alert("ä¼ºæœå™¨éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦");
                });

        }
        function loadOnDelistProducts() {
            fetch("http://localhost:8087/api/ShShop/myProds", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: new URLSearchParams({ action: "notAvailable" })
            })
                .then(res => res.json())
                .then(res => {
                    if (!res || !res.data || !Array.isArray(res.data)) {
                        console.error("å›å‚³æ ¼å¼éŒ¯èª¤", res);
                        return;
                    }

                    const tbody = document.querySelector("tbody");
                    tbody.innerHTML = "";

                    const onSale = res.data;

                    if (onSale.length === 0) {
                        tbody.innerHTML = "<tr><td colspan='7'>ç›®å‰æ²’æœ‰ä¸‹æ¶çš„å•†å“</td></tr>";
                        return;
                    }

                    onSale.forEach(prod => {
                        const firstImg = prod.picUrls?.[0] || "https://via.placeholder.com/60";
                        const tr = document.createElement("tr");

                        tr.innerHTML = `
                        <td><img class="prod-img" src="${firstImg}" alt="å•†å“åœ–ç‰‡" /></td>
                        <td>${prod.prodName}</td>
                        <td>$${prod.prodPrice}</td>
                        <td>${prod.prodCount}</td>
                        <td>${prod.prodDesc}</td>
                        <td>${prod.prodStatusStr}</td>
                    `;
                        tbody.appendChild(tr);
                    });
                })
                .catch(err => {
                    console.error("è¼‰å…¥å·²ä¸‹æ¶å•†å“å¤±æ•—ï¼š", err);
                });
        }
        function loadOnPendingProducts() {
            fetch("http://localhost:8087/api/ShShop/myProds", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: new URLSearchParams({ action: "OnPending" })
            })
                .then(res => res.json())
                .then(res => {
                    if (!res || !res.data || !Array.isArray(res.data)) {
                        console.error("å›å‚³æ ¼å¼éŒ¯èª¤", res);
                        return;
                    }

                    const tbody = document.querySelector("tbody");
                    tbody.innerHTML = "";
                    const onSale = res.data;

                    if (onSale.length === 0) {
                        tbody.innerHTML = "<tr><td colspan='7'>ç›®å‰æ²’æœ‰å¯©æ ¸ä¸­çš„å•†å“</td></tr>";
                        return;
                    }

                    onSale.forEach(prod => {
                        const firstImg = prod.picUrls?.[0] || "https://via.placeholder.com/60";
                        const tr = document.createElement("tr");

                        tr.innerHTML = `
                        <td><img class="prod-img" src="${firstImg}" alt="å•†å“åœ–ç‰‡" /></td>
                        <td>${prod.prodName}</td>
                        <td>$${prod.prodPrice}</td>
                        <td>${prod.prodCount}</td>
                        <td>${prod.prodDesc}</td>
                        <td>${prod.prodStatusStr}</td>
                    `;
                        tbody.appendChild(tr);
                    });
                })
                .catch(err => {
                    console.error("è¼‰å…¥å¯©æ ¸ä¸­å•†å“å¤±æ•—ï¼š", err);
                });
        }
    </script>







</body>

</html>