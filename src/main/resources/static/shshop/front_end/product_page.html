<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product detailsï½œMatchMarket</title>
    <link rel="stylesheet" href="css/header.css" />
    <link rel="stylesheet" href="css/product_page.css" />

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
</head>

<body>

    <header class="header">
        <!-- Logo å€ -->
        <div class="header__logo">
            <a href="/">
                <img src="../../img/logoText.png" alt="Logo" />
            </a>
        </div>

        <!-- å°è¦½åˆ— -->
        <nav class="header__nav">
            <ul class="header__list">
                <li class="header__item"><a href="#">é…å°</a></li>
                <li class="header__item"><a href="#">èŠå¤©å®¤</a></li>
                <li class="header__item"><a href="#">æ´»å‹•</a></li>
                <li class="header__item"><a href="#">è¨è«–å€</a></li>

                <!-- ğŸ”½ MatchMarket Dropdown -->
                <li class="header__item dropdown">
                    <a href="select_page.html">MatchMarket</a>
                    <ul class="dropdown-menu">
                        <li><a href="select_page.html">çœ‹ä¸€ä¸‹å•†å“</a></li>
                        <li class="dropdown-submenu">
                            <a href="product_manager.html">My MatchMarket</a>
                            <ul class="dropdown-menu">
                                <li><a href="add_product.html">ä¸Šæ¶å•†å“</a></li>
                                <li><a href="#">å·²è³¼è³£å•†å“</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>

                <li class="header__item"><a href="#">æœƒå“¡å°ˆå€</a></li>
            </ul>
        </nav>

        <!-- ä½¿ç”¨è€…åœ–ç¤º -->
        <div class="header__user">
            <i class="fa-solid fa-user"></i>
        </div>
    </header>



    <main class="main-detail">
        <div class="product-page">
            <div class="product-top">
                <div class="left-image-box">
                    <div class="main-img">
                        <img src="https://placehold.co/300x300" alt="ä¸»åœ–" id="mainImage">
                    </div>


                    <div class="thumbnail-bar-wrapper">
                        <button class="nav-arrow" id="prevBtn">â†</button>
                        <div class="thumbnail-track"></div>
                        <button class="nav-arrow" id="nextBtn">â†’</button>
                    </div>
                </div>

                <form class="right-info-box" id="buyForm" action="/buy" method="post">
                    <h1 class="prodName">å•†å“åç¨±ï¼š</h1>
                    <h1 class="price">åƒ¹æ ¼ï¼š<span class="price_info">$175</span></h1>
                    <div class="info-grid">
                        <p><strong class="brand">å“ç‰Œï¼š</strong></p>
                        <p><strong class="prod_type">å•†å“é¡åˆ¥ï¼š</strong></p>
                        <p><strong class="prod_view">å•†å“ç€è¦½æ¬¡æ•¸ï¼š</strong></p>
                        <p><strong class="qty">å•†å“æ•¸é‡ï¼š</strong></p>
                    </div>
                    <div class="form-group">
                        <div class="qty-label-row">
                            <label for="buyQty">è³¼è²·æ•¸é‡ï¼š</label>
                            <div class="qty-box">
                                <button type="button" class="qty-btn" id="decreaseBtn">-</button>
                                <input type="number" id="buyQty" name="buyQty" min="1" value="1">
                                <button type="button" class="qty-btn" id="increaseBtn">+</button>
                            </div>
                            <button type="submit" class="buy-btn">è³¼è²·</button>
                        </div>

                        <div class="chat-row">
                            <button type="button" class="chat-btn" onclick="alert('å‰å¾€èˆ‡è³£å®¶èŠå¤©');">
                                èˆ‡è³£å®¶æœƒå“¡èŠå¤©
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <div class="product-description-sections">
                <section class="product-section">
                    <h2>å•†å“å…§å®¹ï¼š</h2>
                    <p>å•†å“å…§å®¹ä»‹ç´¹...</p>
                </section>
                <section class="product-section">
                    <h2>å•†å“æ•˜è¿°ï¼š</h2>
                    <p>å•†å“çš„è©³ç´°æè¿°æˆ–èªªæ˜</p>
                </section>
                <section class="product-section">
                    <h2>è³£å®¶æœƒå“¡è³‡æ–™ï¼š</h2>
                    <p>è³£å®¶æš±ç¨±ã€è©•åƒ¹ã€ä»‹ç´¹ç­‰è³‡è¨Š</p>
                </section>
            </div>
        </div>
    </main>
    <div id="imgModal"
        style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background-color:rgba(0,0,0,0.7); z-index:1000; justify-content:center; align-items:center;">
        <span class="close-modal"
            style="position:absolute; top:20px; right:30px; font-size:2.5rem; color:#fff; cursor:pointer;">&times;</span>
        <img id="modalImg" src="" alt="æ”¾å¤§åœ–ç‰‡" style="max-width:90%; max-height:90%;">
    </div>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get("id");

            if (!productId) {
                console.error("æŸ¥ç„¡å•†å“");
                return;
            }

            const mainImg = document.querySelector(".main-img img");
            const thumbnailTrack = document.querySelector(".thumbnail-track");
            let thumbnails = [];
            let currentImgIndex = 0;

            // å¾å¾Œç«¯å–å¾—å•†å“è³‡æ–™
            fetch(`http://localhost:8080/api/ShShop/getProd?id=${productId}`)
                .then(response => {
                    if (!response.ok) throw new Error("å¾Œç«¯å›å‚³éŒ¯èª¤");
                    return response.json();
                })
                .then(responseData => {
                    const data = responseData.data;

                    // è¨­å®šä¸»åœ–
                    if (data.picUrls && data.picUrls.length > 0) {
                        mainImg.src = data.picUrls[0];
                        mainImg.alt = data.prodName;

                        // å»ºç«‹ç¸®åœ–åˆ—
                        data.picUrls.forEach((url, index) => {
                            const thumb = document.createElement("img");
                            thumb.src = url;
                            thumb.alt = `å•†å“åœ–${index + 1}`;
                            thumb.addEventListener("click", () => {
                                mainImg.src = url;
                                currentImgIndex = index;
                            });
                            thumbnailTrack.appendChild(thumb);
                            thumbnails.push(thumb);
                        });
                    }

                    // é»ä¸»åœ–æ”¾å¤§
                    mainImg.addEventListener("click", () => {
                        document.getElementById("modalImg").src = mainImg.src;
                        document.getElementById("imgModal").style.display = "flex";
                    });

                    // å•†å“è³‡è¨Š
                    document.querySelector(".prodName").textContent = `å•†å“åç¨±ï¼š${data.prodName}`;
                    document.querySelector(".price").innerHTML = `åƒ¹æ ¼ï¼š<strong class='price_info'>$${data.prodPrice}</strong>`;
                    document.querySelector(".brand").innerHTML = `<strong>å•†å“å“ç‰Œï¼š</strong>${data.prodBrand}`;
                    document.querySelector(".qty").innerHTML = `<strong>å•†å“æ•¸é‡ï¼š</strong>${data.prodCount}`;
                    document.querySelector(".prod_type").innerHTML = `<strong>å•†å“é¡åˆ¥ï¼š</strong>${data.prodTypeName}`;
                    document.querySelector(".prod_view").innerHTML = `<strong>å•†å“ç€è¦½æ¬¡æ•¸ï¼š</strong>${data.prodViews}`;

                    document.querySelectorAll(".product-section")[0].querySelector("p").textContent = data.prodContent;
                    document.querySelectorAll(".product-section")[1].querySelector("p").textContent = data.prodDesc;
                    document.querySelectorAll(".product-section")[2].querySelector("p").textContent = `ä¸Šæ¶è€…ï¼š${data.userName}`;

                    // æ•¸é‡æ§åˆ¶
                    const qtyInput = document.getElementById("buyQty");
                    if (qtyInput && data.prodCount) {
                        qtyInput.max = data.prodCount;

                        qtyInput.addEventListener("input", () => {
                            let val = parseInt(qtyInput.value);
                            if (val < 1) qtyInput.value = 1;
                            if (val > parseInt(qtyInput.max)) qtyInput.value = qtyInput.max;
                        });

                        document.getElementById("increaseBtn").onclick = () => {
                            const current = parseInt(qtyInput.value);
                            if (current < parseInt(qtyInput.max)) qtyInput.value = current + 1;
                        };

                        document.getElementById("decreaseBtn").onclick = () => {
                            const current = parseInt(qtyInput.value);
                            if (current > 1) qtyInput.value = current - 1;
                        };
                    }
                })
                .catch(err => {
                    console.error("è¼‰å…¥å•†å“è³‡æ–™å¤±æ•—ï¼š", err);
                });

            // å·¦å³ç®­é ­åˆ‡æ›ä¸»åœ–
            document.querySelectorAll(".nav-arrow")[0].addEventListener("click", () => {
                if (thumbnails.length > 0) {
                    currentImgIndex = (currentImgIndex - 1 + thumbnails.length) % thumbnails.length;
                    mainImg.src = thumbnails[currentImgIndex].src;
                }
            });

            document.querySelectorAll(".nav-arrow")[1].addEventListener("click", () => {
                if (thumbnails.length > 0) {
                    currentImgIndex = (currentImgIndex + 1) % thumbnails.length;
                    mainImg.src = thumbnails[currentImgIndex].src;
                }
            });

            // é—œé–‰åœ–ç‰‡ Modal
            document.querySelector(".close-modal").addEventListener("click", () => {
                document.getElementById("imgModal").style.display = "none";
            });

            // é¡¯ç¤ºå¾Œç«¯å›å‚³çš„éŒ¯èª¤è¨Šæ¯ï¼ˆå¦‚æœæœ‰ï¼‰
            const serverErrorDiv = document.getElementById('serverErrorContainer');
            const backendErrorMessage = serverErrorDiv?.getAttribute('data-error-message-th');
            const pwdMismatchMessage = serverErrorDiv?.getAttribute('data-pwd-mismatch-th');

            if (backendErrorMessage && backendErrorMessage.trim() !== 'null' && backendErrorMessage.trim() !== '') {
                showMessage(backendErrorMessage, 'error');
            }
            if (pwdMismatchMessage && pwdMismatchMessage.trim() !== 'null' && pwdMismatchMessage.trim() !== '') {
                showMessage(pwdMismatchMessage, 'error');
            }
        });
    </script>






</body>

</html>